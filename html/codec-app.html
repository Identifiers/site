<!DOCTYPE html>
<!-- hex editor component for byte: https://github.com/michbil/hex-works -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Identifiers encode/decode UI</title>
</head>
<body>

  <!-- development version, includes helpful console warnings -->
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <!-- production version, optimized for size and speed
  <script src='https://cdn.jsdelivr.net/npm/vue'></script>
  -->

  <script src="https://unpkg.com/vue-slicksort@latest/dist/vue-slicksort.umd.js"></script>

  <script src="https://unpkg.com/identifiers-js/dist/identifiers.bundle.js"></script>


  <div id="app">
    Decode: <unknown-encoded></unknown-encoded>

    <p>String: <string-id></string-id></p>

    <string-list-id></string-list-id>

    <p>Boolean: <boolean-id></boolean-id></p>

    <boolean-list-id></boolean-list-id>
    <!--
    TODO
    * string map
    * Boolean list / map
    * integer / list / map
    * float / list / map
    * long / list / map
    * bytes / list / map
    * datetime / list / map
    * uuid / list / map
    * geo / list / map
    * composite list / map
    -->
  </div>
</body>

<script lang="javascript">

  // these have to be named this way so v-model works on parent components
  const VALUE = 'value';
  const INPUT = 'input';

  const baseInputComponent = {
    props: [VALUE],
    data() {
      return {valueInput: this[VALUE]};
    },
    methods: {
      updateInput(value) {
        this.$emit(INPUT, value);
      }
    }
  };

  Vue.component('string-input', {
    ...baseInputComponent,
    template: '<input placeholder="enter a string value" v-bind:value="valueInput" v-on:input="updateInput($event.target.value.trim())"/>',
  });

  Vue.component('boolean-input', {
    ...baseInputComponent,
    template: '<input type="checkbox" v-bind:checked="valueInput" v-on:input="updateInput($event.target.checked)"/>',
  });

  Vue.component('unknown-encoded', {
    template: '<div><string-input v-model="encodedString"/><p>decoded: {{ decodedId }}</p></div>',
    data: () => ({ encodedString: 'Ç/IÒÁIÖêqÉ34uwâêl7Tþ' }),
    computed: {
      decodedId() {
        try {
          return ID.decodeFromString(this.$data.encodedString).toString();
        }
        catch (e) {
          return `Cannot decode ${this.$data.encodedString}`;
        }
      }
    }
  });

  const wrapItem = (content) => ({content: content, id: Math.random()});

  const {SlickList, SlickItem} = window.VueSlicksort;

  Vue.component('string-id', {
    template: '<div><string-input v-model="stringValue"/><span> Data: {{ encodedData }}, Human: {{ encodedHuman }}</span></div>',
    data: () => ({ stringValue: 'matt' }),
    computed: {
      encodedData() {
        return this.$data.stringValue ? ID.factory.string(this.$data.stringValue).toDataString() : '';
      },
      encodedHuman() {
        return this.$data.stringValue ? ID.factory.string(this.$data.stringValue).toHumanString() : '';
      }
    }
  });

  Vue.component('string-list-id', {
    template: `
    <div>
      <SlickList v-model="items">
        <SlickItem v-for="(item, index) in items" :key="item.id" :index="index">
          <button @click="deleteItem(index)">-</button><string-input v-model="item.content"></string-input>{{ item.content }}
        </SlickItem>
      </SlickList>
      <button @click="createNewItem">Add New Item</button>
      <br/>
      List: {{ idDebugString }}<br/>
      Data: {{ encodedData }}<br/>
      Human: {{ encodedHuman }}
    </div>`,
    components: {
      SlickItem,
      SlickList
    },
    data: () => ({
      items: ['Abby', 'Bao', 'Callum', 'Derek', 'Edgar', 'Farhad', 'Guiseppe'].map(wrapItem)
    }),
    methods: {
      createNewItem() {
        this.items.push(wrapItem(''));
      },
      deleteItem(index) {
        this.items.splice(index, 1);
      }
    },
    computed: {
      idDebugString() {
        return this.$data.items.map(v => v.content);
      },
      encodedData() {
        return ID.factory.string.list(this.$data.items.map(v => v.content)).toDataString();
      },
      encodedHuman() {
        return ID.factory.string.list(this.$data.items.map(v => v.content)).toHumanString();
      }
    }
  });

  Vue.component('boolean-id', {
    template: `<div><boolean-input v-model="booleanValue"/><span> Data: {{ encodedData }}, Human: {{ encodedHuman }}</span></div>`,
    data: () => ({ booleanValue: true }),
    computed: {
      encodedData() {
        return ID.factory.boolean(this.$data.booleanValue).toDataString();
      },
      encodedHuman() {
        return ID.factory.boolean(this.$data.booleanValue).toHumanString();
      }
    }
  });

  Vue.component('boolean-list-id', {
    template: `
    <div>
      <SlickList v-model="items">
        <SlickItem v-for="(item, index) in items" :key="item.id" :index="index">
          <button @click="deleteItem(index)">-</button><boolean-input v-model="item.content"></boolean-input>{{ item.content }}
        </SlickItem>
      </SlickList>
      <button @click="createNewItem">Add New Item</button>
      <br/>
      List: {{ idDebugString }}<br/>
      Data: {{ encodedData }}<br/>
      Human: {{ encodedHuman }}
    </div>`,
    components: {
      SlickItem,
      SlickList
    },
    data: () => ({
      items: [true, false, true].map(wrapItem)
    }),
    methods: {
      createNewItem() {
        this.items.push(wrapItem(false));
      },
      deleteItem(index) {
        this.items.splice(index, 1);
      }
    },
    computed: {
      idDebugString() {
        return this.$data.items.map(v => v.content);
      },
      encodedData() {
        return ID.factory.boolean.list(this.$data.items.map(v => v.content)).toDataString();
      },
      encodedHuman() {
        return ID.factory.boolean.list(this.$data.items.map(v => v.content)).toHumanString();
      }
    }
  });

  const app = new Vue({
    el: '#app',
  });
</script>
</html>